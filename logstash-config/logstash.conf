input {
  beats {
    port => 5000
  }
}

filter {
  grok {
    match => {
      "message" => "Timestamp:\s*%{TIMESTAMP_ISO8601:timestamp}\s+Level:\s*%{WORD:log_level}\s+Service:\s*%{DATA:log_service}\s+Message:\s*%{GREEDYDATA:log_message}"
    }
  }

  # Handle timestamp parsing explicitly
  date {
    match => ["timestamp", "ISO8601"]
    target => "@timestamp"
    timezone => "UTC"  # Optional: Set timezone if logs lack it
  }

  mutate {
    rename => {
      "timestamp" => "original_timestamp"  # Rename after date parsing
    }
    remove_field => ["message"]  # Optional: Remove original log line
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "microservice-logs-%{+YYYY.MM.dd}"
  }
}